<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Principal</title>
    <script src="https://code.jquery.com/jquery-3.7.1.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" 
    rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" 
    crossorigin="anonymous">
    <link rel="stylesheet" href="all.css">
    <style>
        #generador{
            display: none;
        }
    </style>
    <script>
        function recargar(){
            window.location.href = "recargar.html";
            
        }

        document.addEventListener("DOMContentLoaded", function() {
            // Recuperar el valor de usuario de la cookie
            var cookies = document.cookie.split(";");
            var usuario = "";
            for (var i = 0; i < cookies.length; i++) {
                var cookie = cookies[i].trim();
                if (cookie.indexOf("usuario=") === 0) {
                    usuario = cookie.substring("usuario=".length, cookie.length);
                    break;
                }
            }

            // Establecer el valor del campo de entrada
            var usuarioInput = document.querySelector("input[type='text'][placeholder='usuario']");
            usuarioInput.value = usuario;

            saldo();
        });

        function saldo(){

            usuarioSaldo = $("#txtUsuarioSaldo").val();
            datosSaldo = { usuarioSaldo: usuarioSaldo };

            $.ajax({
                data: datosSaldo,
                type: "post",
                url: "retornar.php",
                success: function(response) {
                    document.getElementById('txtSaldo').value = response;
                }
            });
        }

        function solicitar(){
            // Crear el formulario dinámicamente
            var formularioQR = document.createElement("div");
                formularioQR.className = "form";
                formularioQR.innerHTML = `
                    <input type="text" spellcheck="false" placeholder="Ingrese su contraseña" id="txtContraseniaQR">
                    <button onclick="solicitar2()">Verificar</button>
                `;

                // Agregar el formulario al elemento con el id "resultado"
                var resultado = document.getElementById("resultado");
                resultado.appendChild(formularioQR);
        }

        function solicitar2(){
            usuarioQR = $("#txtUsuarioSaldo").val();
            contraseniaQR = $("#txtContraseniaQR").val();
            datosQR = { usuarioQR: usuarioQR, contraseniaQR: contraseniaQR };

            $.ajax({
                data: datosQR,
                type: "post",
                url: "solicitarQR.php",
                success: function(response) {
                    $("#resultado2").html(response);
                    document.getElementById('generador').style.display = "block";
                    document.getElementById('resultado2Input').value = response;
                }
            });
        }
    </script>
</head>
<body style="overflow-y: hidden;">
    <h1 style="text-align: center;">LINEA 2 METRO DE LIMA</h1>
    <div style="text-align: center;">
        <img src="imagenes/logo.png" alt="" style="width: 200px; height: 200px;">
    </div>
    <table>
        <tr>
            <td>usuario:</td>
            <td> <input type="text" placeholder="usuario" id="txtUsuarioSaldo" readonly></td>
            <td>

            </td>
        </tr>
        <tr>
            <td>Tu saldo es</td>
            <td> <input type="text" id="txtSaldo" readonly></td>
        </tr>
        <tr>
            <td>
                <input type="button" value="Recargar" onclick="recargar()">
            </td>
        </tr>
    </table>
    <div>
        <header>
          <h2>Solicitar Codigo QR</h3>
            <button onclick="solicitar()">Solicitar</button>
        </header>
        <!--<div class="form">
          <input type="text" spellcheck="false" placeholder="ingrese el texto o la direccion URL" id="txtIdUsuario">
          <button>Generar</button>
        </div>
        <div class="qr-code">
          <img src="" alt="qr-code">
          
          <button id="descarga">Descargar </button>
        
        </div>-->
    </div>
      <div id="resultado"></div>
      <div id="resultado2"></div>
      <div id="generador">
        <div class="wrapper">
            <header>
              <h2>Codigo QR</h2>
              <p>Su Id de Usuario es:</p>
            </header>
            <div class="form">
              <input type="text" spellcheck="false" id="resultado2Input" readonly>
              <button>Generador QR</button>
            </div>
            <div class="qr-code">
              <img src="" alt="qr-code">
              
              <button id="descarga">Descargar </button>
            </div>
          </div>
      </div>
      <script src="script.js"></script>
    <script src="file.js"></script>
</body>
</html>
